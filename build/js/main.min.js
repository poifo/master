/*! JailBreak 2015-08-04 */
requirejs.config({baseUrl:"http://7mnmwm.com1.z0.glb.clouddn.com/js/build/lib",paths:{angular:"angular-route-animate.min",jquery:"jquery.min",bootstrap:"bootstrap.min",markdown:"markdown.min",hljs:"highlight.pack"},shim:{angular:{exports:"angular"},bootstrap:{deps:["jquery"],exports:"bootstrap"},markdown:{exports:"markdown"}}}),requirejs(["jquery","angular","bootstrap"],function(a,b){var c,d,e,f,g,h,i;return d=!1,b.element(document).ready(function(){return setTimeout(function(){return b.bootstrap(document,["myblog"])})}),c=b.module("myblog",["ui.router","ngAnimate"]),c.config(["$stateProvider","$urlRouterProvider",function(a,b){return a.state("index",{url:"",templateUrl:"/template/page-main.html"}).state("main",{url:"/",templateUrl:"/template/page-main.html"}).state("cv",{url:"/cv",templateUrl:"/template/page-cv.html"}).state("contact",{url:"/contact",templateUrl:"/template/page-msg.html"}).state("project",{url:"/projects",templateUrl:"/template/page-project.html"}).state("blog",{url:"/blog",templateUrl:"/template/page-blog.html",controller:"blog"}).state("blog.list",{url:"/:type",templateUrl:"/template/page-blog-list.html",controller:"bloglist"}).state("blog.detail",{url:"/post/:article",templateUrl:"/template/page-blog-detail.html",controller:"blogdetail"}).state("developing",{url:"/developing",templateUrl:"/template/page-developing.html"}),b.otherwise(d?"/":"/developing")}]),c.factory("AuthService",["$http",function(){var a;return a={},{}}]),c.directive("celAnimate",["$rootScope",function(b){return{restrict:"EA",link:function(c,d){var e,f;if(!(a(window).width()<768))return a(d).addClass("cel-hide"),f=0,e=function(){var b,c,e;if(!a(d).hasClass("cel-show"))return b=a(window).height(),e=a(window).scrollTop(),c=a(d).offset().top,b>=c-e&&a(d).removeClass("cel-hide").addClass("cel-show"),f=1},e(),a(window).scroll(function(){return f=0}),b.$on("$routeChangeSuccess",function(){return setTimeout(function(){return e()})}),setInterval(function(){return 0===f?e():void 0},200)}}}]),c.directive("cover",function(){return{restrict:"EA",link:function(b,c){var d;return d=function(){var b,d,e,f;return c=a(c),d=c.width(),f=a(window).width(),b=c.height(),e=a(window).height(),c.css("min-width",e*d/b+"px"),e===b?c.css("left","-"+(d-f)/2+"px"):c.css("left",0)},d(),window.onresize=function(){return d()}}}}),c.directive("changeFont",function(){return{restrict:"A",link:function(b,c){var d,e,f;return d=["cursive","-webkit-body","-webkit-pictograph","fantasy","serif"],e=0,f={},a(c).hover(function(){var b,c;return b=this,c=a(".navbar-brand"),f.now=setInterval(a.proxy(function(){return a(c).css("font-family",d[e]),a(b).css("font-family",d[e]),++e>=5?e=0:void 0}),200)},function(){return clearInterval(f.now)})}}}),c.directive("scrollFade",function(){return{restrict:"A",link:function(b,c){var d,e,f,g;if(!(a(window).width()<768))return d=a(c),e=a(window),f=d.height(),g=d.offset().top,e.scroll(function(){var a,b,c;return c=e.scrollTop(),c>g&&2*f>=c-g?(b=(c-g)/(2*f)+1,a=1-(c-g)/(2*f),d.css({transform:"scale("+b+")",opacity:a})):void 0})}}}),c.directive("drag",function(){return{restrict:"EA",link:function(b,c){var d;return c=a(c),(d=function(){var b,d,e;return e=0,b=0,d=0,c.mousedown(function(f){return console.log(b),e=1,b=f.clientX,d=f.clientY,a("body").mousemove(function(d){var f;return console.log("start2"+e),e?(f=d.clientX-b,b=d.clientX,c.parent().css("left","+="+f+"px"),a(".bk-left").css("width","+="+f+"px"),a(".bk-right").css("left","+="+f+"px")):void 0}),a("body").mouseup(function(){return 1===e?(e=0,a("body").unbind("mousemove"),a("body").unbind("mouseup")):void 0})})})()}}}),c.directive("showDetail",function(){return{restrict:"A",link:function(b,c,d){var e;return e=a(".bk-"+d.showDetail),a(c).hover(function(){return a(window).width()>768?(e.addClass("active"),a(".round").not(a(this)).addClass("fadeout")):void 0},function(){return a(window).width()>768?(e.removeClass("active"),a(".round").not(a(this)).removeClass("fadeout")):void 0})}}}),c.directive("vgGo",function(){return{restrict:"A",link:function(b,c,d){return a(c).click(function(){return window.location.href=d.vgGo})}}}),c.directive("markdown",function(){return{restrict:"A",scope:{content:"=markdownText"},link:function(b,c,d){var e,f,g,h;return h=d.theme?d.theme:"zenburn",e=require.toUrl("/style/lib/hightlight/"+h+".css"),f=document.createElement("link"),f.type="text/css",f.rel="stylesheet",f.href=e,document.getElementsByTagName("head")[0].appendChild(f),g='<div class="spinner"> <div class="rect1"></div> <div class="rect2"></div> <div class="rect3"></div> <div class="rect4"></div> <div class="rect5"></div> </div>',c.html(g),requirejs(["markdown","hljs"],function(d,e){return b.$watch(function(){return b.content},function(b){return b?(c.html(d.toHTML(b)),a(c).find("pre>code").each(function(a,b){return e.highlightBlock(b)})):c.html(g)}),b.content?(c.html(d.toHTML(b.content)),a(c).find("pre>code").each(function(a,b){return e.highlightBlock(b)})):c.html(g)})}}}),c.directive("themeSwitcher",function(){return{restrict:"E",scope:{themes:"=themes"},link:function(){return localStorage.getItem("theme")?void 0:localStorage.setItem("theme","green")},controller:["$scope","$rootScope","$timeout","$http",function(b,c){var d,e,f;f=[],e="1080x1800",a(window).width()<500&&(e="500x500xz"),d={green:"http://gtms01.alicdn.com/tps/i1/TB1I3coIFXXXXaOXpXXxjZKVXXX-1200-675.jpg_"+e+".jpg",pink:"http://gtms03.alicdn.com/tps/i3/TB1CUj9IFXXXXbNaXXX9l.7UFXX-1920-1080.jpg_"+e+".jpg",purple:"http://gtms04.alicdn.com/tps/i4/TB1euAmIFXXXXbnXpXX9l.7UFXX-1920-1080.jpg_"+e+".jpg",blue:"http://gtms01.alicdn.com/tps/i1/TB1jEEuIFXXXXXrXXXX9l.7UFXX-1920-1080.jpg_"+e+".jpg",yellow:"http://gtms03.alicdn.com/tps/i3/TB1e4EaIFXXXXcuXVXX9l.7UFXX-1920-1080.jpg_"+e+".jpg"},this.gotChanged=function(e){var g,h;return g=function(){var d,g,h;return f.forEach(function(a){return a!==e?a.selected=!1:void 0}),b.themes.themeClass="theme-"+e.color,localStorage.setItem("theme",e.color),e.loaded=!0,d="url("+e.url+")",g=a(".header-background.bg-leave"),h=a(".header-background.bg-enter"),h.removeClass("bg-enter").addClass("bg-leave"),g.removeClass("bg-leave").addClass("bg-enter").css("background-image",d),c.$broadcast("themeChangeSuccess")},e.loaded?void g():(e.img=new Image,window.URL.createObjectURL?(c.$broadcast("themeChangeStart",{fake:!1}),h=new XMLHttpRequest,h.open("GET",d[e.color]),h.responseType="blob",h.onreadystatechange=function(){return 4===h.readyState?e.url=window.URL.createObjectURL(h.response):void 0},h.onprogress=function(a){return c.$apply(function(){return c.$broadcast("themeChangeProgress",a)})},h.send()):(c.$broadcast("themeChangeStart",{fake:!0}),e.img.src=e.url=d[e.color]),h.onload=e.img.onload=g)},this.addThemes=function(a){return f.push(a)}}]}}),c.directive("switcher",["$rootScope","$timeout",function(){return{restrict:"EA",template:"<i ng-click=\"toggleTheme()\" class=\"{{theme.selected ? 'active' : ''}} glyphicon glyphicon-sunglasses\"></i>",replace:!0,transclude:!0,require:"^themeSwitcher",scope:{theme:"=tm"},link:function(a,b,c,d){var e;return a.theme.selected=!1,e=localStorage.getItem("theme"),d.addThemes(a.theme),a.toggleTheme=function(){return a.theme.selected=!0,d.gotChanged(a.theme)},e===a.theme.color?a.toggleTheme():void 0}}}]),c.directive("progressTool",["$rootScope","$timeout",function(a,b){return{restrict:"EA",replace:!0,template:'<div class="progress {{mhide}}"> <div class="progress-bar progress-bar-danger" role="progressbar" aria-valuenow="{{percent}}" aria-valuemin="0" aria-valuemax="100" style="width: {{percent}}%;"> <span class="{{showPercent ? \'\' : \'sr-only\'}}">{{percent}}%</span> </div> </div>',scope:{percent:"=percent",showPercent:"=showPercent"},link:function(a){return a.mhide="",a.percent+="",a.$watch(function(){return a.percent},function(){return"100"===a.percent?(b(function(){return a.percent="0",a.mhide="hide"},500),b(function(){return a.mhide=""},800)):void 0})}}}]),h=function(b){var c,d,e,f,g,h,i,j,k;for(h={title:"",type:"",tag:"",disc:"",url:"",hide:""},g="零 一 二 三 四 五 六 七 八 九 十 十一 十二".split(" "),i=b.split("\n"),c=0,e=i.length;e>c;c++)f=i[c],j=f.split(":"),d=j[0],k=j[1],d=a.trim(d),k=a.trim(k),h.hasOwnProperty(d)&&(h[d]=k);return h.date=h.url.split("-"),h.date.month=g[parseInt(h.date[1],10)],h.date.day=parseInt(h.date[2],10),h},f=function(a){var b;return b=[],a=a.split(/\n[\-=]+/),a.forEach(function(a){return a=h(a),"true"!==a.hide?b.push(a):void 0}),b},i=function(a){var b;return b=[],a.forEach(function(a){return-1===b.indexOf(a.type)?b.push(a.type):void 0}),b},g=function(a){var b,c,d,e,f,g,i,j;for(b=!1,c="",j="",i=a.split("\n"),d=0,e=i.length;e>d;d++)f=i[d],/[\-=]+/.test(f)&&(b=!0),b?j+="\n"+f:c+="\n"+f+"\n";return g=h(c),g.text=j,"true"!==g.hide?g:void 0},e=function(a,b){var c,d,e,f,g;if(b&&(g=b),g&&a&&"all"!==g){for(f=[],d=0,e=a.length;e>d;d++)c=a[d],c.type===g&&f.push(c);return f}return a},c.filter("blogListType",function(){var a;return a=e}),c.controller("blog",["$scope","$http","$rootScope","$timeout","$location","$stateParams",function(a,b,c){return b.get("/post/list.md").success(function(b){return a.blogList=a.blogListOrigin=f(b),a.listType=i(a.blogList)}),a.percent="0",c.$on("themeChangeStart",function(b,c){return a.percent=c.fake?"30":"0"}),c.$on("themeChangeSuccess",function(){return a.percent="100"}),c.$on("themeChangeProgress",function(b,c){return a.percent=c.loaded/c.total*100+"",console.log(a.percent)}),a.themes=[{color:"green",selected:!0},{color:"blue",selected:!1},{color:"purple",selected:!1},{color:"yellow",selected:!1},{color:"pink",selected:!1}],a.themes.themeClass="theme-green"}]),c.controller("bloglist",["$rootScope","$scope","$http","$stateParams",function(a,b,c,d){return b.blogtype=a.blogtype=d.type}]),c.controller("blogdetail",["$scope","$http","$stateParams","$timeout","$location",function(a,b,c,d,e){var f;return b.get("/post/"+c.article).success(function(b){return b=g(b),a.title=b.title,a.article=b.text,f(".blog-detail")}),f=function(b){var c;return c=document.createElement("div"),c.setAttribute("id",e.url()),c.setAttribute("data-thread-key",a.title),c.setAttribute("data-url",e.url()),DUOSHUO.EmbedThread(c),jQuery(b).append(c)}}])});